<!DOCTYPE html>
<html>
	<head>
		<title>Emacs org-drill org-capture org-protocol with firefox</title>
		<link rel="stylesheet" type="text/css" href="/css/main.css">
		<link rel="stylesheet" type="text/css" href="/css/syntax.css">
	</head>
	<body>
		<nav>
			<ul>
				<li><a href="/">Home</a></li>
				<li><a href="/blog">Blog</a></li>
			</ul>
		</nav>
		<div class="container">
			<h1>Emacs org-drill org-capture org-protocol with firefox</h1>
<p class="meta">07 Mar 2017</p>

<div class="post">
     <p>Emacs can be used as flash card tool, I fallowed the page of <a href="http://orgmode.org/worg/org-contrib/org-drill.html">org-drill</a>.
In emacs 25.1, need to install <code class="highlighter-rouge">org-plus-contrib</code> first. While installing <code class="highlighter-rouge">org-plus-conrib</code>, may get error <code class="highlighter-rouge">Invalid function: org-babel-header-args-safe-fn</code>, I use cpaulik’s solution: <a href="https://github.com/syl20bnr/spacemacs/issues/4618">remove the ob_R.elc</a>. And I find one emacs plugin <a href="https://github.com/Malabarba/paradox">paradox</a>, which can be used to manage the installed plugins.
In <code class="highlighter-rouge">Incremental reading</code>, it shows how to integrate <code class="highlighter-rouge">org-drill</code> with external browser. It’s good to integrate <code class="highlighter-rouge">firefox</code> which is my default browser. I’m running <code class="highlighter-rouge">Arch</code> linux with windows manager <code class="highlighter-rouge">fluxbox</code>, it take me some time to make it working. At begining, i follow the <a href="http://orgmode.org/worg/org-contrib/org-protocol.html">org-protocol</a>, but the <code class="highlighter-rouge">gconftool-2</code> did not work, even i have <code class="highlighter-rouge">gconftool</code> installed, and have those configuration in my ~/.config, <code class="highlighter-rouge">firefox</code> always get error <code class="highlighter-rouge">(org-protocol) isn’t associated with any program</code>. I just wondered how can i configure the firefox, use application I specified. Then i tried use <code class="highlighter-rouge">network.protocol-handler.app.org-protocol</code>, got the same error. Then I tried to figure out which application controls the default application in my environment. Then I found <a href="https://wiki.archlinux.org/index.php/Default_applications">Arch default applications</a>, but I don’t have normal desktop environment, I have <code class="highlighter-rouge">xdg</code> installed. How to let my installed application use <code class="highlighter-rouge">xdg-open</code> to open default application for specified mime type? I still don’t know when I write is post. At least I tried to add desktop file into <code class="highlighter-rouge">xdg</code>, and configure the default application for that desktop file, luckly it works. Below is the configuration in my environment:</p>

<ul>
  <li>emacs configuration</li>
</ul>

<div class="language-elisp highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="nv">require-package</span> <span class="ss">'org-plus-contrib</span><span class="p">)</span>
<span class="p">(</span><span class="nv">after-load</span> <span class="ss">'org</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">'org-drill</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">'org-protocol</span><span class="p">)</span>
  <span class="p">)</span>

  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-capture-templates</span>
      <span class="o">`</span><span class="p">((</span><span class="s">"w"</span>
         <span class="s">"Capture web snippet"</span>
         <span class="nv">entry</span>
         <span class="p">(</span><span class="nv">file+headline</span> <span class="s">"~/test-drill.org"</span> <span class="s">"Notes"</span><span class="p">)</span>
         <span class="o">,</span><span class="p">(</span><span class="nv">concat</span> <span class="s">"* Fact: '%:description'        :"</span>
                  <span class="p">(</span><span class="nb">format</span> <span class="s">"%s"</span> <span class="nv">org-drill-question-tag</span><span class="p">)</span>
                  <span class="s">":\n:PROPERTIES:\n:DATE_ADDED: %u\n:SOURCE_URL: %c\n:END:\n\n%i\n%?\n"</span><span class="p">)</span>
         <span class="ss">:empty-lines</span> <span class="mi">1</span>
         <span class="ss">:immediate-finish</span> <span class="no">t</span><span class="p">)</span>
        <span class="p">))</span>

</code></pre>
</div>

<ul>
  <li>firefox configuration</li>
</ul>

<p>add <code class="highlighter-rouge">network.protocol-handler.expose.org-protocol:false</code> into about:config, details can be found <a href="http://kb.mozillazine.org/Register_protocol">Register protocol</a></p>

<p>add one bookmark with url:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">javascript</span><span class="err">:</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s1">'org-protocol://capture://w/'</span><span class="o">+</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">)</span><span class="o">+</span><span class="s1">'/'</span><span class="o">+</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">)</span><span class="o">+</span><span class="s1">'/'</span><span class="o">+</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">getSelection</span><span class="p">())</span>
</code></pre>
</div>

<ul>
  <li>xdg configuration</li>
</ul>

<p>add file <code class="highlighter-rouge">emacsclient.desktop</code> in folder <code class="highlighter-rouge">~/.local/share/applications</code> with content:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[Desktop Entry]
Name=Emacs Client
Exec=emacsclient %u
Icon=emacs-icon
Type=Application
Terminal=false
MimeType=x-scheme-handler/org-protocol;
</code></pre>
</div>

<p>add <code class="highlighter-rouge">x-scheme-handler/org-protocol=emacsclient.desktop</code> in file <code class="highlighter-rouge">~/.local/share/applications/mimeapps.list</code>, under the section <code class="highlighter-rouge">[Default Applications]</code></p>

</div>

		</div>
		<footer>
			<ul>
				<li><a href="mailto:lbl52001@gmail.com">email</a></li>
				<li><a href="https://github.com/baolonglin">github page</a></li>
			</ul>
		</footer>
	</body>
</html>
