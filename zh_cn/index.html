<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="zh_cn">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a site for Baolong.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BaoLong</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (zh_cn)" href="rss.xml">
<link rel="canonical" href="https://baolonglin.github.io/zh_cn/">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">跳到主内容</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://baolonglin.github.io/zh_cn/">

                <span id="blog-title">BaoLong</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">文章存档</a>
                </li>
<li>
<a href="categories/">标签</a>
                </li>
<li>
<a href="rss.xml">RSS 源</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
            </li>
<li><a href="https://baolonglin.github.io/" rel="alternate" hreflang="en">English</a></li>

                
                    
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/include_next-stdlibh-failed/" class="u-url">include_next stdlib.h failed</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baolong Lin
            </span></p>
            <p class="dateline"><a href="posts/include_next-stdlibh-failed/" rel="bookmark"><time class="published dt-published" datetime="2018-01-03T13:00:18+01:00" title="2018-01-03 13:00">2018-01-03 13:00</time></a></p>
                <p class="commentline">
        
    <a href="posts/include_next-stdlibh-failed/#disqus_thread" data-disqus-identifier="cache/posts/include_next-stdlibh-failed.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <p>
Recently I met below error while using <a href="https://github.com/Andersbakken/rtags">rtags</a> to parse my code:
</p>
<blockquote>
<p>
handleInclude failed (nil) inclusion directive include stdlib.h /opt/gcc/6.2.0/include/c++/6.2.0/cstdlib:75:1
</p>
</blockquote>

<p>
But the source file was compiled success with the specified GCC(6.2.0), the 75 line of cstlib is:
</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">_next &lt;stdlib.h&gt;</span><span class="cp"></span>
</pre></div>

<p>
I tried to find the stdlib.h under gcc 6.2.0, there are two files:
</p>
<blockquote>
<p>
/opt/gcc/6.2.0/include/c++/6.2.0/tr1/stdlib.h
/opt/gcc/6.2.0/include/c++/6.2.0/stdlib.h
</p>
</blockquote>
<p>
check the stdlib.h under /usr/include, there are six files:
</p>
<blockquote>
<p>
/usr/include/c++/4.7/tr1/stdlib.h
/usr/include/c++/4.3/tr1/stdlib.h
/usr/include/stdlib.h
/usr/include/bind/isc/stdlib.h
/usr/include/dhcp/isc/stdlib.h
/usr/include/bits/stdlib.h
</p>
</blockquote>

<p>
Checked the default include directories of compiler with `/opt/gcc/6.2.0/bin/g++ -xc++ -v -E -dM -`, there is no tr1 related directory, but we find that `/usr/include` is the last one in the include directories.
</p>
<blockquote>
<p>
Using built-in specs.
COLLECT<sub>GCC</sub>=/opt/gcc/6.2.0/bin/g++
Target: x86<sub>64</sub>-pc-linux-gnu
Configured with: /local/working/gcc-6.2.0/configure –prefix=/opt/gcc/6.2.0 –enable-languages=c,c++,fortran –enable-libmpx –with-as=/opt/binutils/2.25/bin/as –with-gnu-as
Thread model: posix
gcc version 6.2.0 (GCC)
COLLECT<sub>GCC</sub><sub>OPTIONS</sub>='-v' '-E' '-dM' '-shared-libgcc' '-mtune=generic' '-march=x86-64'
 <i>opt/gcc/6.2.0/bin</i>../libexec/gcc/x86<sub>64</sub>-pc-linux-gnu/6.2.0/cc1plus -E -quiet -v -iprefix <i>opt/gcc/6.2.0/bin</i>../lib/gcc/x86<sub>64</sub>-pc-linux-gnu/
6.2.0/ -D<sub>GNU</sub><sub>SOURCE</sub> - -mtune=generic -march=x86-64 -dM
ignoring nonexistent directory "<i>opt/gcc/6.2.0/bin</i>../lib/gcc/x86<sub>64</sub>-pc-linux-gnu/6.2.0/../../../../x86<sub>64</sub>-pc-linux-gnu/include"
ignoring duplicate directory "<i>opt/gcc/6.2.0/bin</i>../lib/gcc/../../lib/gcc/x86<sub>64</sub>-pc-linux-gnu/6.2.0/../../../../include/c++/6.2.0"
ignoring duplicate directory "<i>opt/gcc/6.2.0/bin</i>../lib/gcc/../../lib/gcc/x86<sub>64</sub>-pc-linux-gnu/6.2.0/../../../../include/c++/6.2.0/x86<sub>64</sub>-pc-linux-gnu"
ignoring duplicate directory "<i>opt/gcc/6.2.0/bin</i>../lib/gcc/../../lib/gcc/x86<sub>64</sub>-pc-linux-gnu/6.2.0/../../../../include/c++/6.2.0/backward"
ignoring duplicate directory "<i>opt/gcc/6.2.0/bin</i>../lib/gcc/../../lib/gcc/x86<sub>64</sub>-pc-linux-gnu/6.2.0/include"
ignoring duplicate directory "<i>opt/gcc/6.2.0/bin</i>../lib/gcc/../../lib/gcc/x86<sub>64</sub>-pc-linux-gnu/6.2.0/include-fixed"
ignoring nonexistent directory "<i>opt/gcc/6.2.0/bin</i>../lib/gcc/../../lib/gcc/x86<sub>64</sub>-pc-linux-gnu/6.2.0/../../../../x86<sub>64</sub>-pc-linux-gnu/include"
#include "…" search starts here:
#include &lt;…&gt; search starts here:
 <i>opt/gcc/6.2.0/bin</i>../lib/gcc/x86<sub>64</sub>-pc-linux-gnu/6.2.0/../../../../include/c++/6.2.0
 <i>opt/gcc/6.2.0/bin</i>../lib/gcc/x86<sub>64</sub>-pc-linux-gnu/6.2.0/../../../../include/c++/6.2.0/x86<sub>64</sub>-pc-linux-gnu
 <i>opt/gcc/6.2.0/bin</i>../lib/gcc/x86<sub>64</sub>-pc-linux-gnu/6.2.0/../../../../include/c++/6.2.0/backward
 <i>opt/gcc/6.2.0/bin</i>../lib/gcc/x86<sub>64</sub>-pc-linux-gnu/6.2.0/include
 <i>opt/gcc/6.2.0/bin</i>../lib/gcc/x86<sub>64</sub>-pc-linux-gnu/6.2.0/include-fixed
 <i>usr/local/include
 /opt/gcc/6.2.0/bin</i>../lib/gcc/../../include
 /usr/include
End of search list.
</p>
</blockquote>

<p>
Which stdlib.h is the compiler required?
</p>

<p>
First we need to know the meaning of include<sub>next</sub>, according GCC <a href="https://gcc.gnu.org/onlinedocs/cpp/Wrapper-Headers.html">Wrapper Header</a>:
</p>
<blockquote>
<p>
Include the next file with this name. This directive works like #include except in searching for the specified file: it starts searching the list of header file directories after the directory in which the current file was found.
</p>
</blockquote>
<p>
#include<sub>next</sub> is used for add stuff to the header file without replace it entirely in C++ header files.
</p>

<p>
Then we can use `/opt/gcc/6.2.0/bin/g++ -M` to show the include files:
</p>
<blockquote>
<p>
/opt/gcc/6.2.0/include/c++/6.2.0/cstdlib
/usr/include/stdlib.h
</p>
</blockquote>

<p>
Then the left thing is make the correct order of include pathes. The `/user/include` path must behind the `/opt/gcc/6.2.0/include/c++/6.2.0`.
</p>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/blogging-with-emacs-org-nikola-on-android/" class="u-url">Blogging with emacs org, nikola on android</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baolong Lin
            </span></p>
            <p class="dateline"><a href="posts/blogging-with-emacs-org-nikola-on-android/" rel="bookmark"><time class="published dt-published" datetime="2017-12-29T22:55:21+01:00" title="2017-12-29 22:55">2017-12-29 22:55</time></a></p>
                <p class="commentline">
        
    <a href="posts/blogging-with-emacs-org-nikola-on-android/#disqus_thread" data-disqus-identifier="cache/posts/blogging-with-emacs-org-nikola-on-android.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <p>
It's useful to write blog on mobile which reachable
any spare time. I use <a href="https://termux.com">Termux</a> as a Linux environment.
</p>
<div class="highlight"><pre><span></span>apt install emacs clang git python python-dev libxml2 libxml2-dev libxslt libxslt-dev libjpeg-turbo-dev ndk-sysroot
pip install virtualenv
mkdir ~/pyenv
virtualenv ~/pyenv/nikola
<span class="nb">source</span> ~/pyenv/nikola/activate
<span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">"-L/system/lib/"</span> <span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">"-I/data/data/com.termux/files/usr/include/"</span> pip install --upgrade <span class="s2">"Nikola[extras]"</span>
git clone &lt;git repo&gt; ~/blog
</pre></div>
<p>
Now setup the Emacs, start new post as on laptop.
</p>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/quite-nice-to-write-blog-with-emacs-org-nikola/" class="u-url">Quite nice to write blog with emacs org nikola</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baolong Lin
            </span></p>
            <p class="dateline"><a href="posts/quite-nice-to-write-blog-with-emacs-org-nikola/" rel="bookmark"><time class="published dt-published" datetime="2017-12-29T15:41:15+01:00" title="2017-12-29 15:41">2017-12-29 15:41</time></a></p>
                <p class="commentline">
        
    <a href="posts/quite-nice-to-write-blog-with-emacs-org-nikola/#disqus_thread" data-disqus-identifier="cache/posts/quite-nice-to-write-blog-with-emacs-org-nikola.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <p>
Plan to use <a href="https://getnikola.com/">Nikola</a> as my blogging tool when I read cestlaz's blog <a href="http://cestlaz.github.io/posts/2016-04-17-emacs-jekyll-nikola/">Blogging with Emacs, Jekyll and Nikola</a>. Today I fallow streakycobra's nice blog <a href="https://streakycobra.github.io/posts/blogging-in-org-mode-with-nikola/">Blogging in org-mode with Nikola</a> setup my blog on github.
It's quit simple and looks nice, the big thing is I can use org-mode to write blog without extra steps.
</p>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/maintain-test-cases-with-org-mode/" class="u-url">Maintain test cases with org-mode</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baolong Lin
            </span></p>
            <p class="dateline"><a href="posts/maintain-test-cases-with-org-mode/" rel="bookmark"><time class="published dt-published" datetime="2017-12-29T14:26:15+01:00" title="2017-12-29 14:26">2017-12-29 14:26</time></a></p>
                <p class="commentline">
        
    <a href="posts/maintain-test-cases-with-org-mode/#disqus_thread" data-disqus-identifier="cache/posts/maintain-test-cases-with-org-mode.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div id="outline-container-orgde437b4" class="outline-2">
<h2 id="orgde437b4">Introduction</h2>
<div class="outline-text-2" id="text-orgde437b4">
<p>
Org-mode is known as good tool to do planning/scheduling, but it also used as <a href="http://howardism.org/Technical/Emacs/literate-programming-tutorial.html">literate programming tool</a>. It's quite nice to use <a href="http://orgmode.org/worg/org-contrib/babel/">Babel</a> to execute code inside org-mode, it should be possible to use org-mode write test case.
Right now I could not find one native way inside org-mode to support this.
The tool I need to test is quit simple, <a href="https://clang.llvm.org/docs/ClangFormat.html">clang-format</a>, input one code snippet, output formated code.
</p>
</div>
</div>

<div id="outline-container-org3797fb3" class="outline-2">
<h2 id="org3797fb3">Prequirements</h2>
<div class="outline-text-2" id="text-org3797fb3">
<p>
Here list my environment:
</p>
<ul class="org-ul">
<li>Emacs 26</li>
<li>Org-mode 9.1.4</li>
<li>Babel load language elisp, bash</li>
<li>org-element</li>
</ul>
</div>
</div>

<div id="outline-container-orgb7c255b" class="outline-2">
<h2 id="orgb7c255b">Setup</h2>
<div class="outline-text-2" id="text-orgb7c255b">
<p>
Just create one org file, input content like:
</p>
<div class="highlight"><pre><span></span>* Test title
** Setup
#+BEGIN_SRC elisp
(setq org-confirm-babel-evaluate nil)
#+END_SRC
** Test suite title
*** Test case title
    &lt;&lt; add test case content here, use yasnippet to insert here &gt;&gt;
** Report
#+BEGIN_SRC emacs-lisp
  (org-element-map (org-element-parse-buffer) '(fixed-width example-block)
    (lambda (result)
      (progn
	(list (org-element-property :results result)
	      (if (string-prefix-p "PASS" (org-element-property :value result) )
		  "PASS"
		"FAILED")
	      )
	))
    )
#+END_SRC
</pre></div>

<p>
The content under Setup headline describes the setup information.
The content under Report headline describes the test result report.
The test case use yasnippet like:
</p>
<div class="highlight"><pre><span></span># -*- mode: snippet -*-
# name: tftc
# key: tftc
# --
*** ${1: test case name}
#+name: ${1:$(replace-regexp-in-string " " "-" (downcase yas-text))}
#+BEGIN_SRC bash :results verbatim
format_result="$(clang-format &lt;&lt; EOF
{
${2: input original source code}
}
EOF
)"

require_format="$(cat &lt;&lt; EOF
{
${3: input expected source code}
}
EOF
)"

diff -u &lt;(echo "$format_result") &lt;(echo "$require_format")
if [ "$?" -eq 0 ]; then
echo "PASS"
else
echo "FAILED"
fi
#+END_SRC
</pre></div>

<p>
After added the test case just execute org-babel-execute-buffer, the test report will be generated in the end of current org file.
The test result looks like:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">(test-case-1)</td>
<td class="org-left">PASS</td>
</tr>
<tr>
<td class="org-left">(test-case-2)</td>
<td class="org-left">PASS</td>
</tr>
<tr>
<td class="org-left">(test-case-3)</td>
<td class="org-left">FAILED</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org023ce91" class="outline-2">
<h2 id="org023ce91">Conclusion</h2>
<div class="outline-text-2" id="text-org023ce91">
<p>
The solution is not perfect enough, it has duplicate shell code under each test case, the input/output code could not be highlight.
The report is quit simple, when test cases number becomes large, require better solution to show the test result.
</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/2017/5/18/my-first-emacs-package/" class="u-url">My first emacs package</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baolong Lin
            </span></p>
            <p class="dateline"><a href="posts/2017/5/18/my-first-emacs-package/" rel="bookmark"><time class="published dt-published" datetime="2017-05-18T00:00:00+02:00" title="2017-05-18 00:00">2017-05-18 00:00</time></a></p>
                <p class="commentline">
        
    <a href="posts/2017/5/18/my-first-emacs-package/#disqus_thread" data-disqus-identifier="cache/posts/2017/5/18/my-first-emacs-package.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>After using emacs for serval monthes, come out my first emacs package. It may not such useful, but it solves my daily work problem.</p>
<p>The package is stored at <a href="https://github.com/baolonglin/switch-process-environment">switch-process-environment</a>. It's quiet simple, just manages the emacs process environment, enables user switch the process environments.</p>
<p>In my daily work, I need to switch between different shell environments in one project. Different shell environments provides different toolset, and those environment variables are conflict with each other. Restart emacs and recover the desktop session cost time, different git commit can have different environment variables.</p>
<p>With that package, I can keep one emacs as daemon, don't need to restart the emacs to switch the different environment.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/2017/3/7/emacs-org-drill-org-capture-firefox/" class="u-url">Emacs org-drill org-capture org-protocol with firefox</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baolong Lin
            </span></p>
            <p class="dateline"><a href="posts/2017/3/7/emacs-org-drill-org-capture-firefox/" rel="bookmark"><time class="published dt-published" datetime="2017-03-07T00:00:00+01:00" title="2017-03-07 00:00">2017-03-07 00:00</time></a></p>
                <p class="commentline">
        
    <a href="posts/2017/3/7/emacs-org-drill-org-capture-firefox/#disqus_thread" data-disqus-identifier="cache/posts/2017/3/7/emacs-org-drill-org-capture-firefox.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Emacs can be used as flash card tool, I fallowed the page of <a href="http://orgmode.org/worg/org-contrib/org-drill.html">org-drill</a>.
In emacs 25.1, need to install <code>org-plus-contrib</code> first. While installing <code>org-plus-conrib</code>, may get error <code>Invalid function: org-babel-header-args-safe-fn</code>, I use cpaulik's solution: <a href="https://github.com/syl20bnr/spacemacs/issues/4618">remove the ob_R.elc</a>. And I find one emacs plugin <a href="https://github.com/Malabarba/paradox">paradox</a>, which can be used to manage the installed plugins.
In <code>Incremental reading</code>, it shows how to integrate <code>org-drill</code> with external browser. It's good to integrate <code>firefox</code> which is my default browser. I'm running <code>Arch</code> linux with windows manager <code>fluxbox</code>, it take me some time to make it working. At begining, i follow the <a href="http://orgmode.org/worg/org-contrib/org-protocol.html">org-protocol</a>, but the <code>gconftool-2</code> did not work, even i have <code>gconftool</code> installed, and have those configuration in my ~/.config, <code>firefox</code> always get error <code>(org-protocol) isn’t associated with any program</code>. I just wondered how can i configure the firefox, use application I specified. Then i tried use <code>network.protocol-handler.app.org-protocol</code>, got the same error. Then I tried to figure out which application controls the default application in my environment. Then I found <a href="https://wiki.archlinux.org/index.php/Default_applications">Arch default applications</a>, but I don't have normal desktop environment, I have <code>xdg</code> installed. How to let my installed application use <code>xdg-open</code> to open default application for specified mime type? I still don't know when I write is post. At least I tried to add desktop file into <code>xdg</code>, and configure the default application for that desktop file, luckly it works. Below is the configuration in my environment:</p>
<ul>
<li>emacs configuration</li>
</ul>
<pre class="code literal-block"><span></span><span class="p">(</span><span class="nv">require-package</span> <span class="ss">'org-plus-contrib</span><span class="p">)</span>
<span class="p">(</span><span class="nv">after-load</span> <span class="ss">'org</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">'org-drill</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">'org-protocol</span><span class="p">)</span>
  <span class="p">)</span>

  <span class="p">(</span><span class="k">setq</span> <span class="nv">org-capture-templates</span>
      <span class="o">`</span><span class="p">((</span><span class="s">"w"</span>
         <span class="s">"Capture web snippet"</span>
         <span class="nv">entry</span>
         <span class="p">(</span><span class="nv">file+headline</span> <span class="s">"~/test-drill.org"</span> <span class="s">"Notes"</span><span class="p">)</span>
         <span class="o">,</span><span class="p">(</span><span class="nf">concat</span> <span class="s">"* Fact: '%:description'        :"</span>
                  <span class="p">(</span><span class="nf">format</span> <span class="s">"%s"</span> <span class="nv">org-drill-question-tag</span><span class="p">)</span>
                  <span class="s">":\n:PROPERTIES:\n:DATE_ADDED: %u\n:SOURCE_URL: %c\n:END:\n\n%i\n%?\n"</span><span class="p">)</span>
         <span class="nb">:empty-lines</span> <span class="mi">1</span>
         <span class="nb">:immediate-finish</span> <span class="no">t</span><span class="p">)</span>
        <span class="p">))</span>
</pre>


<ul>
<li>firefox configuration</li>
</ul>
<p>add <code>network.protocol-handler.expose.org-protocol:false</code> into about:config, details can be found <a href="http://kb.mozillazine.org/Register_protocol">Register protocol</a></p>
<p>add one bookmark with url:</p>
<pre class="code literal-block"><span></span><span class="nx">javascript</span><span class="o">:</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s1">'org-protocol://capture://w/'</span><span class="o">+</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">)</span><span class="o">+</span><span class="s1">'/'</span><span class="o">+</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">)</span><span class="o">+</span><span class="s1">'/'</span><span class="o">+</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">getSelection</span><span class="p">())</span>
</pre>


<ul>
<li>xdg configuration</li>
</ul>
<p>add file <code>emacsclient.desktop</code> in folder <code>~/.local/share/applications</code> with content:</p>
<pre class="code literal-block"><span></span><span class="k">[Desktop Entry]</span>
<span class="na">Name</span><span class="o">=</span><span class="s">Emacs Client</span>
<span class="na">Exec</span><span class="o">=</span><span class="s">emacsclient %u</span>
<span class="na">Icon</span><span class="o">=</span><span class="s">emacs-icon</span>
<span class="na">Type</span><span class="o">=</span><span class="s">Application</span>
<span class="na">Terminal</span><span class="o">=</span><span class="s">false</span>
<span class="na">MimeType</span><span class="o">=</span><span class="s">x-scheme-handler/org-protocol;</span>
</pre>


<p>add <code>x-scheme-handler/org-protocol=emacsclient.desktop</code> in file <code>~/.local/share/applications/mimeapps.list</code>, under the section <code>[Default Applications]</code></p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/2017/3/4/learn-some-elisp-1/" class="u-url">Learn some elisp [1]</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baolong Lin
            </span></p>
            <p class="dateline"><a href="posts/2017/3/4/learn-some-elisp-1/" rel="bookmark"><time class="published dt-published" datetime="2017-03-04T00:00:00+01:00" title="2017-03-04 00:00">2017-03-04 00:00</time></a></p>
                <p class="commentline">
        
    <a href="posts/2017/3/4/learn-some-elisp-1/#disqus_thread" data-disqus-identifier="cache/posts/2017/3/4/learn-some-elisp-1.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p><code>directory-file-name</code>: Remove the file slash in Unix-syntax</p>
<p><code>file-name-directory</code>: Get the directory of file</p>
<p>In emacs, directory is also handled like file.
The way to get parent directory:</p>
<pre class="code literal-block"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">parent-directory</span> <span class="p">(</span><span class="nv">dir</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">equal</span> <span class="s">"/"</span> <span class="nv">dir</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">file-name-directory</span> <span class="p">(</span><span class="nf">directory-file-name</span> <span class="nv">dir</span><span class="p">)))</span>
  <span class="p">)</span>
</pre>


<p><code>with-temp-buffer</code>: Create a temporary buffer</p>
<p><code>insert-file-contents</code>: Insert contents of file after point</p>
<p><code>split-string</code>: split string into substrings</p>
<p><code>thing-at-point</code>: return the ting at point</p>
<p>Below function get value of specified attribute name from file.
The structure in the file like
attributeName: attributeValue</p>
<pre class="code literal-block"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">get-attribute-from-mi-file</span> <span class="p">(</span><span class="nv">mi-file</span> <span class="nv">attrName</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">with-temp-buffer</span>
    <span class="p">(</span><span class="nf">insert-file-contents</span> <span class="nv">mi-file</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">moreLines</span> <span class="no">t</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">attrFound</span> <span class="no">nil</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">lineToken</span> <span class="o">'</span><span class="p">()))</span>
      <span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">and</span> <span class="nv">moreLines</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">attrFound</span><span class="p">))</span>
        <span class="p">(</span><span class="k">setq</span> <span class="nv">lineToken</span>
              <span class="p">(</span><span class="nv">split-string</span> <span class="p">(</span><span class="nv">thing-at-point</span> <span class="ss">'line</span> <span class="no">t</span><span class="p">)</span> <span class="s">":"</span> <span class="no">t</span> <span class="nv">split-string-default-separators</span><span class="p">))</span>
        <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">&gt;=</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">lineToken</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">equal</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">lineToken</span><span class="p">)</span> <span class="nv">attrName</span><span class="p">))</span>
          <span class="p">(</span><span class="k">setq</span> <span class="nv">attrFound</span> <span class="no">t</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">(</span><span class="k">setq</span> <span class="nv">moreLines</span> <span class="p">(</span><span class="nf">=</span> <span class="mi">0</span> <span class="p">(</span><span class="nf">forward-line</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="p">)</span>
      <span class="p">(</span><span class="nb">when</span> <span class="nv">attrFound</span>
        <span class="p">(</span><span class="nf">car</span> <span class="p">(</span><span class="nv">last</span> <span class="nv">lineToken</span><span class="p">))))</span>
    <span class="p">)</span>
  <span class="p">)</span>
</pre>


<p><code>save-excursion</code>: Save point, and current buffer</p>
<p><code>search-backward</code>: Search backward from point for string</p>
<p><code>backward-char</code>: Move point backword</p>
<p>Below function try to fetch the class name of toString method in C++ style.
This function only expect that the implementation of toString is out of class
declaration.</p>
<pre class="code literal-block"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">fetch-tostring-classname</span> <span class="p">(</span><span class="nv">pos</span><span class="p">)</span>
  <span class="p">(</span><span class="k">save-excursion</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">search-backward</span> <span class="s">"::toString()"</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">backward-char</span> <span class="mi">2</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">thing-at-point</span> <span class="ss">'symbol</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">)</span>
</pre>


<p><code>file-name-as-directory</code>: Just appends a slash for a Uix-syntas file name</p>
<p><code>concat</code>: concatenate strings</p>
<p>Below function concat one directory with several directory or file names.
(concat-path '/opt/apps/' 'a' 'b' 'c') returns /opt/apps/a/b/c</p>
<pre class="code literal-block"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">concat-path</span> <span class="p">(</span><span class="nv">directoryName</span> <span class="nv">fileName</span> <span class="kp">&amp;rest</span> <span class="nv">otherFileNames</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">concatPath</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">directoryName</span> <span class="nv">fileName</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">while</span> <span class="nv">otherFileNames</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">concatPath</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">file-name-as-directory</span> <span class="nv">concatPath</span><span class="p">)</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">otherFileNames</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">otherFileNames</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">otherFileNames</span><span class="p">)))</span>
    <span class="nv">concatPath</span>
    <span class="p">)</span>
  <span class="p">)</span>
</pre>


<p><code>string-match</code>: Get the index of start of first match, or nil</p>
<p><code>match-string</code>: Get the string of text matched by last search.</p>
<p>Below function extract one string from another string, and assume that the original string has the defined format. the input string like foo/barCT, the return string is bar.</p>
<pre class="code literal-block"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">get-ct-component</span> <span class="p">(</span><span class="nv">ctIdentity</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">string-match</span> <span class="s">"\\w+/\\(\\w+\\)CT"</span> <span class="nv">ctIdentity</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">match-string</span> <span class="mi">1</span> <span class="nv">ctIdentity</span><span class="p">)</span>
  <span class="p">)</span>
</pre>


<p><code>with-current-buffer</code>: Keep current buffer, execute on other buffer</p>
<p><code>start-process</code>: start a programm in a subprocess.</p>
<p><code>pop-to-buffer</code>: Select buffer in some window, perferably a different one.</p>
<p><code>erase-buffer</code>: Delete the entire contents of the current buffer.</p>
<p><code>get-buffer-create</code>: Get the buffer specified by buffer name, createing a new one if needed.</p>
<p>Below function create one buffer <code>ct-run</code> if not exist, clear the buffer. Execute program ct_run output to that buffer, then switch to that buffer.</p>
<pre class="code literal-block"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">mi-ct-run</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">with-current-buffer</span> <span class="p">(</span><span class="nf">get-buffer-create</span> <span class="s">"*ct-run*"</span><span class="p">)</span> <span class="p">(</span><span class="nf">erase-buffer</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">start-process</span> <span class="s">"ct-run"</span> <span class="s">"*ct-run*"</span> <span class="s">"ct_run"</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">pop-to-buffer</span> <span class="s">"*ct-run*"</span><span class="p">))</span>
</pre>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/2017/3/2/restore-work-space/" class="u-url">Restore workspace</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baolong Lin
            </span></p>
            <p class="dateline"><a href="posts/2017/3/2/restore-work-space/" rel="bookmark"><time class="published dt-published" datetime="2017-03-02T00:00:00+01:00" title="2017-03-02 00:00">2017-03-02 00:00</time></a></p>
                <p class="commentline">
        
    <a href="posts/2017/3/2/restore-work-space/#disqus_thread" data-disqus-identifier="cache/posts/2017/3/2/restore-work-space.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Recently, I tried to setup my working environment. The product I worked on mostly using C++, and the application is running on one OS similar as BSD enabled multi-processes programming style. I owned one dedicate Linux machine to code, run function test, etc. but I don't have the root permission. That machine provide nx server, it works quit well, but the nx server is too old that sometimes met annoying issue, only terminate session can solve the problem. Terminate session causes the working environment disappear. Another problem is the machine may reboot by administrator to do maintain work. Here is the current solution, it's quit ok now.</p>
<ul>
<li><a href="https://tmux.github.io/">tmux</a></li>
</ul>
<p>Tmux is used to keep the application without window, and also easy to manage different work area. And use <a href="https://github.com/tmux-plugins/tmux-resurrect">tmux-resurrect</a> to store the information incase OS is restarted.</p>
<ul>
<li>ssh + shell script</li>
</ul>
<p>To get rid of nx server, use ssh directly. Tmux could not keep the X window's session, here use shell script to restart the X11 application.</p>
<pre class="code literal-block"><span></span>ssh -YXC -c blowfish-cbc,arcfour user@host -t <span class="se">\"</span>tmux attach -t work <span class="se">\\\\</span><span class="p">;</span> split-window ~/bin/restore.sh<span class="se">\"</span><span class="s2">"</span>
</pre>


<p>Below is the <code>restore.sh</code></p>
<pre class="code literal-block"><span></span><span class="ch">#!/bin/sh</span>

<span class="nv">PROMPT_START</span><span class="o">=</span><span class="s2">"\[</span><span class="k">$(</span>hostname<span class="k">)</span><span class="s2">\]"</span>
<span class="nv">ORIG_WINDOW_INDEX</span><span class="o">=</span><span class="sb">`</span>tmux display-message -p <span class="s1">'#I'</span><span class="sb">`</span>
<span class="nv">ORIG_PANE_INDEX</span><span class="o">=</span><span class="sb">`</span>tmux display-message -p <span class="s1">'#P'</span><span class="sb">`</span>

<span class="nv">TMUX_DISPLAY_ENV</span><span class="o">=</span><span class="sb">`</span>tmux show-environment DISPLAY <span class="p">|</span> cut -d<span class="o">=</span> -f2<span class="sb">`</span>
<span class="nv">UPDATE_DISPLAY</span><span class="o">=</span><span class="s2">"setenv DISPLAY </span><span class="si">${</span><span class="nv">TMUX_DISPLAY_ENV</span><span class="si">}</span><span class="s2">"</span>

<span class="k">for</span> window in <span class="sb">`</span>tmux list-windows -F <span class="s1">'#I'</span><span class="sb">`</span><span class="p">;</span> <span class="k">do</span>
    tmux <span class="k">select</span>-window -t <span class="nv">$window</span>

    <span class="k">for</span> pane in <span class="k">$(</span>tmux list-panes -F <span class="s1">'#P'</span><span class="k">)</span><span class="p">;</span> <span class="k">do</span>
        <span class="c1">#tmux send-keys -t ${pane} ""</span>
        <span class="nv">outputLines</span><span class="o">=</span><span class="k">$(</span>tmux capture-pane -p -t <span class="si">${</span><span class="nv">pane</span><span class="si">}</span> <span class="p">|</span> tac<span class="k">)</span>
        <span class="nv">prompt_skipped</span><span class="o">=</span><span class="nb">false</span>
        <span class="k">while</span> <span class="nb">read</span> -r line<span class="p">;</span> <span class="k">do</span>
            <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$prompt_skipped</span><span class="s2">"</span> <span class="o">=</span> <span class="nb">true</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
                <span class="nv">lastStopApp</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> <span class="p">|</span> perl -lne <span class="s1">'/\[\d+\]\s+(Abort|Done|Exit\s+\d+)\s+(.*)$/ &amp;&amp; print $2'</span><span class="k">)</span>
                <span class="k">if</span> <span class="o">[</span> ! -z <span class="s2">"</span><span class="nv">$lastStopApp</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
                    <span class="c1">#echo "$lastStopApp Runs on pane $pane window $window" &gt;&gt; ~/start.log</span>
                    <span class="c1">#TODO do more checks on APP</span>
                    tmux send-keys -t <span class="si">${</span><span class="nv">pane</span><span class="si">}</span> <span class="s2">"</span><span class="si">${</span><span class="nv">UPDATE_DISPLAY</span><span class="si">}</span><span class="s2">"</span> Enter
                    tmux send-keys -t <span class="si">${</span><span class="nv">pane</span><span class="si">}</span> <span class="s2">"</span><span class="si">${</span><span class="nv">lastStopApp</span><span class="si">}</span><span class="s2">&amp;"</span> Enter
                <span class="k">fi</span>
                <span class="nb">break</span>
            <span class="k">fi</span>

            <span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> <span class="o">=</span>~ ^<span class="nv">$PROMPT_START</span>.* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
                <span class="nv">prompt_skipped</span><span class="o">=</span><span class="nb">true</span>
            <span class="k">fi</span>

        <span class="k">done</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$outputLines</span><span class="s2">"</span>
    <span class="k">done</span>
<span class="k">done</span>

tmux <span class="k">select</span>-window -t <span class="nv">$ORIG_WINDOW_INDEX</span>
tmux <span class="k">select</span>-pane -t <span class="nv">$ORIG_PANE_INDEX</span>
</pre>


<p>This script tries to restart the application which executed background and interrupt by the X11 display. Have limitation, this script only handle the last one in pane.</p>
<ul>
<li>emacs + rtags</li>
</ul>
<p>Emacs's desktop can keep the session quit good, rtags manages the C++ AST database.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/2016/12/7/throw-exception-in-destructor/" class="u-url">Throw exception in C++ destructor</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baolong Lin
            </span></p>
            <p class="dateline"><a href="posts/2016/12/7/throw-exception-in-destructor/" rel="bookmark"><time class="published dt-published" datetime="2016-12-07T00:00:00+01:00" title="2016-12-07 00:00">2016-12-07 00:00</time></a></p>
                <p class="commentline">
        
    <a href="posts/2016/12/7/throw-exception-in-destructor/#disqus_thread" data-disqus-identifier="cache/posts/2016/12/7/throw-exception-in-destructor.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>We should <code>Prevent exceptions from leaving destructors</code> as <strong>Effective C++</strong> suggeust, and in that book, it also explains the reason: <code>Now there are two simulataneously active exceptions, and that's one too many for C++</code>. Is not that program interupt when throw one exception? Why two exceptions will be throw out? Let's use one example to make those clear.</p>
<pre class="code literal-block"><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Exception</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Exception</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">_i</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>
    <span class="o">~</span><span class="n">Exception</span><span class="p">()</span> <span class="k">throw</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Throw : "</span> <span class="o">&lt;&lt;</span> <span class="n">_i</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">throw</span> <span class="n">_i</span><span class="p">;</span>        <span class="c1">// &lt;-- 1</span>
    <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">_i</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">OtherObject</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="o">~</span><span class="n">OtherObject</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"~OtherObject"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">OtherObject</span> <span class="n">o</span><span class="p">;</span> <span class="c1">// &lt;-- 2</span>
        <span class="p">{</span>
            <span class="n">Exception</span> <span class="n">e</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>  <span class="c1">// &lt;-- 3</span>
            <span class="c1">//throw 3; // &lt;-- 4</span>
        <span class="p">}</span> <span class="c1">// &lt;-- 4</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"after throw"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// &lt;-- 5</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Catch : "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// &lt;-- 6</span>
    <span class="p">}</span>

    <span class="k">try</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Exception</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// &lt;-- 7</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(...)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Catch something"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// &lt;-- 8</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>


<p>In the example above, use g++ 4.3.4, output looks like:</p>
<pre class="code literal-block"><span></span><span class="n">Throw</span> <span class="o">:</span> <span class="mi">10</span>
<span class="o">~</span><span class="n">OtherObject</span>
<span class="n">Catch</span> <span class="o">:</span> <span class="mi">10</span>
<span class="n">Throw</span> <span class="o">:</span> <span class="mi">0</span>
<span class="n">Throw</span> <span class="o">:</span> <span class="mi">0</span>
<span class="n">terminate</span> <span class="n">called</span> <span class="n">after</span> <span class="n">throwing</span> <span class="n">an</span> <span class="n">instance</span> <span class="n">of</span> <span class="s1">'int'</span>
<span class="n">Aborted</span> <span class="o">(</span><span class="n">core</span> <span class="n">dumped</span><span class="o">)</span>
</pre>


<p><strong>NOTE:</strong> in g++ 6.2.1, it only get one <code>Throw : 0</code>. Because the STL vector's destructor default is noexcept, it terminate the program met the first exception.</p>
<p>What happends? The program is interrupt when object <code>e</code> throws exception in destructor, that's why position 5 is not executed.
But C++ doing a little bit more, it tries to release the object inside the try block, that's why <code>~OtherObject</code> is printed out.
The exception throw by the destructor is caught successfully, position 6 is executed.
What happends at position 7, why position 8 is not executed?
Do another test, if we try to open the position 3, throw exception before object <code>e</code> to be destruct, what will happen? In that case two exceptions are going to be throw out. Now the console output looks like:</p>
<pre class="code literal-block"><span></span><span class="n">Throw</span> <span class="o">:</span> <span class="mi">10</span>
<span class="n">terminate</span> <span class="n">called</span> <span class="n">after</span> <span class="n">throwing</span> <span class="n">an</span> <span class="n">instance</span> <span class="n">of</span> <span class="s1">'int'</span>
<span class="n">Aborted</span> <span class="o">(</span><span class="n">core</span> <span class="n">dumped</span><span class="o">)</span>
</pre>


<p>Haaa, that's <code>too many exceptions for C++</code>, C++ could not handle more than one exception properly, call terminate directly.
Now go back to position 7, it creates 4 instance of <code>Exception</code> and store it in <code>vector</code>, from my understanding, <code>vector</code> just destroy the objects inside it, call destructor of each object.
Here C++ compiler don't interupt the program met the first throw, continue call the destructor of the second object.</p>
<p>It's really bad idea to throw exception from destructor incase C++ need to safely release the temporary object and don't support multiple exceptions could be thrown in one try catch block.
That's why noexcept is the default added in C++11. You'll see warnings like:</p>
<pre class="code literal-block"><span></span>test.cc: In destructor ‘Exception::~Exception()’:
test.cc:12:9: warning: throw will always call terminate() [-Wterminate]
   throw _i;
         ^~
test.cc:12:9: note: in C++11 destructors default to noexcept
</pre>
</div>
    </div>
    </article>
</div>



        
       <script>var disqus_shortname="baolonglin";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2018         <a href="mailto:lbl52001@gmail.com">Baolong Lin</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../assets/js/all-nocdn.js"></script><script src="../assets/js/colorbox-i18n/jquery.colorbox-zh-CN.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("zh-cn");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
